<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link rel="canonical" href="https://yehudab.com/blog/2012/05/otp-il/" />

    
    <meta itemprop="name" content="חישוב מסלול נסיעה בתחבורה ציבורית | בלוג פשוט">
    <meta itemprop="description" content="משרד התחבורה החל לפרסם לפני כשבוע מאגר מידע חדש הכולל לוחות זמנים ונתיבים של התחבורה הציבורית בארץ. המאגר מפורסם לפי תקן פתוח של גוגל שנקרא GTFS. במסגרת שיתוף פעולה של מספר חברים ברשימת התפוצה של המקור, הקמנו פיילוט שמדגים את יכולות המאגר">

    
    <meta name="twitter:title" content="חישוב מסלול נסיעה בתחבורה ציבורית | בלוג פשוט">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="משרד התחבורה החל לפרסם לפני כשבוע מאגר מידע חדש הכולל לוחות זמנים ונתיבים של התחבורה הציבורית בארץ. המאגר מפורסם לפי תקן פתוח של גוגל שנקרא GTFS. במסגרת שיתוף פעולה של מספר חברים ברשימת התפוצה של המקור, הקמנו פיילוט שמדגים את יכולות המאגר">
    <meta name="twitter:site" content="@yehudab">
    <meta name="twitter:creator" content="@yehudab">
    <meta name="twitter:image:src" content="https://yehudab.com/img/2012/05/otp-il-1.png">

    
    <meta property="og:title" content="חישוב מסלול נסיעה בתחבורה ציבורית | בלוג פשוט">
    <meta property="og:description" content="משרד התחבורה החל לפרסם לפני כשבוע מאגר מידע חדש הכולל לוחות זמנים ונתיבים של התחבורה הציבורית בארץ. המאגר מפורסם לפי תקן פתוח של גוגל שנקרא GTFS. במסגרת שיתוף פעולה של מספר חברים ברשימת התפוצה של המקור, הקמנו פיילוט שמדגים את יכולות המאגר">
    <meta property="og:image" content="https://yehudab.com/img/2012/05/otp-il-1.png">
    <meta property="og:url" content="https://yehudab.com/blog/2012/05/otp-il/">
    <meta property="og:site_name" content="בלוג פשוט">
    <meta property="og:locale" content="he_il">
    <meta property="og:type" content="website">

    <link rel="icon" type="image/x-icon" href="/favicon.ico?v=2"/>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <title data-pagefind-meta="title">
      חישוב מסלול נסיעה בתחבורה ציבורית
      
       | בלוג פשוט</title>

    <link rel="stylesheet" href="/assets/main.bundle.css">

    <meta name="generator" content="Eleventy v3.1.0">

    
  </head>
  <body class="flex flex-col min-h-screen">
    <header>
  <nav class="container mx-auto max-w-3xl px-8 pt-2 flex flex-wrap justify-between items-center">
    <!-- Branding -->
    <div>
      <h1>
        <a href="/">בלוג פשוט</a>
      </h1>
      <p>צר עולמי כ  U+200A</p>
    </div>

    <!-- Hamburger Button -->
    <button id="menu-toggle" class="block md:hidden text-gray-700 focus:outline-hidden">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
      </svg>
    </button>

    <!-- Navigation Links -->
    <ul id="menu" class="hidden flex-col md:flex md:flex-row sm:w-1/4 w-full mt-6 md:mt-0 md:justify-between justify-evenly">
      <li>
        <a href="/blog/about" class="block md:inline-block">אודות</a>
      </li>
      <li>
        <a href="/archive" class="block md:inline-block">ארכיון</a>
      </li>
      <li>
        <a href="/blog/search" class="block md:inline-block">חיפוש</a>
      </li>
    </ul>
  </nav>
</header>
<div id="bthn" lang="he"></div>
    <main class="container mx-auto max-w-3xl p-8 grow">
      
    <p></p>
    <div>
        <h2 class="mb-2">חישוב מסלול נסיעה בתחבורה ציבורית</h2>

        
            <div class="mb-2">
                <a class="tag קוד פתוח ותוכנה חופשית" href="/tag/קוד פתוח ותוכנה חופשית/">קוד פתוח ותוכנה חופשית</a>
            </div>
        

        
            <p class="text-sm italic mb-2">נכתב ב<span datetime="2012-05-18T11:21:13.000+03:00">18 במאי 2012</span>.
            </p>
        

        
        
            <p class="text-sm italic">
                <a class="comments-count" 
                    href="#comments">
                    8 תגובות
                </a>
            </p>
        

        <div class="content post" data-pagefind-body>
            <p>משרד התחבורה החל לפרסם לפני כשבוע מאגר מידע חדש הכולל לוחות זמנים ונתיבים של התחבורה הציבורית בארץ. <a href="http://data.gov.il/dataset/383">המאגר</a> מפורסם לפי תקן פתוח של גוגל שנקרא GTFS. במסגרת שיתוף פעולה של מספר חברים ברשימת התפוצה של <a href="http://www.hamakor.org.il/">המקור</a>, הקמנו פיילוט שמדגים את יכולות המאגר. הקוד בפיילוט מבוסס על פרויקט OpenTripPlanner. תודה לירון על עבודת התרגום, ולשאר החברים על העידוד והתמיכה.</p>
<p>עד להקמת שרת ציבורי, ניתן להתרשם מצילומי המסך:</p>
<p>מסלול שלם:<br>
<img src="/img/2012/05/otp-il-1.png" alt="מסלול שלם"></p>
<p>התמקדות על מקטעים:<br>
<img src="/img/2012/05/otp-il-2.png" alt="התמקדות על מקטעים"></p>
<p>גרסה להדפסה:<br>
<img src="/img/2012/05/otp-il-3.png" alt="גרסה להדפסה"></p>
<h3>ההסבר בהמשך מיועד למי שרוצה להקים שרת. לא למי שרוצה לחשב מסלול !! (מה שנקרא: Don't try this at home).</h3>
<p>להקמת השרת, יש לבצע את הפעולות הבאות: (זה הרקע. הקוד בפסקה הבאה מבצע את הפעולות)</p>
<p>לוודא שאזור הזמן של השרת הוא Asia/Jerusalem.<br>
להוריד ולפתוח את הקוד של OpenTripPlanner (גודל הקובץ כ 90MB) וליצור קישור סימבולי ל / .<br>
להוריד ולפתוח קובץ Open Street Map של ישראל מהאתר <a href="http://downloads.cloudmade.com/asia/western_asia/israel">cloudmade.com</a> (גודל הקובץ 22MB).<br>
למצוא את כתובת קובץ ה GTFS <a href="http://data.gov.il/dataset/383">מאתר מאגרי המידע </a>של הממשלה, ולהוריד אותו. מכוון שהקובץ מוגש (זמנית?) משרת ftp ולא http, צריך לארח אותו מחדש על שרת אחר. בדוגמאות הקוד בהמשך האירוח הוא בשרת מקומי</p>
<pre class="language-shell"><code class="language-shell">$ <span class="token function">date</span>
<span class="token comment"># Make sure timezone is correct. If not, run the command:</span>
<span class="token comment"># $ sudo ln -sf /usr/share/zoneinfo/Asia/Jerusalem /etc/localtime</span>
<span class="token comment"># make sure ntp is installed and running. if not, follow these instructions: &lt;a href="http://www.ehow.com/how_8251011_sync-time-centos.html">http://www.ehow.com/how_8251011_sync-time-centos.html&lt;/a></span>
$ <span class="token function">mkdir</span> ~/GTFS
$ <span class="token builtin class-name">cd</span> ~/GTFS
$ <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-O</span> <span class="token string">"http://maps5.trimet.org/otp-dev/otp.zip"</span>
$ <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-O</span> <span class="token string">"http://downloads.cloudmade.com/asia/western_asia/israel/israel.osm.bz2"</span>
$ <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token parameter variable">-O</span> <span class="token string">"ftp://199.203.58.18/israel-public-transportation.zip"</span>
<span class="token comment"># !! replace IP above with correct IP</span>
$ <span class="token function">unzip</span> otp.zip
$ bunzip2 israel.osm.bz2
$ <span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> ~/GTFS/otp /
$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> ~/GTFS/israel.osm /otp/cache/osm/</code></pre>
<p>יש לערוך מספר קבצי הגדרות:</p>
<pre class="language-shell"><code class="language-shell">$ <span class="token function">vi</span> /otp/graph-builder.xml
<span class="token comment"># Line 13, change properties to 'name="path" value="/home/yehuda/GTFS/israel-public-transportation.zip"'</span>
<span class="token comment">#              (or whatever path you placed the file in)</span>
<span class="token comment"># Line 40, change file name of OSM from or-wa.osm to israel.osm (just file part)</span>
$ <span class="token function">vi</span> /otp/bin/build-graph.sh
<span class="token comment"># Line 1, change -Xmx2048m to -Xmx6114m. If you have more memory, put as much as possible</span>
$ <span class="token function">vi</span> /otp/bin/start-server.sh
<span class="token comment"># Line 1, change -Xmx2048m to -Xmx4096m. If you have more memory, put as much as possible</span></code></pre>
<p>בניית הגרף (משלב נתוני OSM עם נתוני תח&quot;ץ)</p>
<pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> /otp
$ bin/build-graph.sh <span class="token operator">>&amp;</span> ~/GTFS/build-graph.err
<span class="token comment"># might take 15-30 minutes depending on processor power and memory</span>
$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> /otp/Graph.obj
<span class="token comment"># should be around 1GB</span></code></pre>
<p>אחרי הריצה חשוב לוודא בלוג שאין תעופה בגלל חוסר זכרון !!</p>
<p>עכשיו אפשר להריץ את השרת האפליקטיבי:</p>
<pre class="language-shell"><code class="language-shell">$ <span class="token builtin class-name">cd</span> /otp
$ bin/start-server.sh
<span class="token comment"># Wait for line: "Winstone Servlet Engine v0.9.10 running..."</span></code></pre>
<p>עכשיו אפשר לפתוח דפדן לכתובת : http://localhost:8080/opentripplanner-webapp/index.html (אם השרת אינו מקומי, להחליף localhost בכתובת השרת). ולנסות לחשב מסלול.</p>
<p>תרגום לעברית:<br>
לבדוק האם הקובץ ‎/otp/webapps/opentripplanner-webapp/js/otp/locale/Hebrew.js‏ קיים. אם לא, להוריד אותו <a href="https://github.com/openplans/OpenTripPlanner/blob/master/opentripplanner-webapp/src/main/webapp/js/otp/locale/Hebrew.js">מכאן</a> ולשמור בנתיב הנ&quot;ל. אחר-כך, יש לבצע מספר תיקונים בקוד:</p>
<pre class="language-shell"><code class="language-shell">$ <span class="token function">vi</span> /otp/webapps/opentripplanner-webapp/index.html
<span class="token comment"># line 2, add 'dir="rtl"' to html tag</span>
<span class="token comment"># line 53, duplicate this line and change file name to "js/otp/locale/Hebrew.js"</span>
$ <span class="token function">vi</span> /otp/webapps/opentripplanner-webapp/js/otp/config.js
<span class="token comment"># line 12, change otp.locale.English to otp.locale.Hebrew (at end of line)</span>
<span class="token comment"># line 175, change value of 'enabled' to 'true'</span>
<span class="token comment"># line 177, add this to end of string:</span>
<span class="token comment"># + '&lt;div style="margin:10px auto;width:205px">&lt;a href="http://www.opentripplanner.org/">&lt;img src="images/logo-otp.png" title="OpenTripPlanner" />&lt;/a>' +  '&lt;a style="margin:0 10px" href="http://www.hamakor.org.il/">&lt;img src="images/logo-hamakor.png" title="עמותת המקור" />&lt;/a>' + '&lt;a href="http://www.hetz.biz/">&lt;img src="images/logo-hetz.png" title="חץ ביז" />&lt;/a>&lt;/div>'</span>
$ <span class="token function">vi</span> /otp/webapps/opentripplanner-webapp/js/otp/locale/Hebrew.js
<span class="token comment"># line 28, change title to: "אודות האתר"</span>
<span class="token comment"># line 29, change content to:</span>
<span class="token comment"># 'אתר זה הוקם ע"י יהודה ב. על בסיס נתוני "לו"ז ומידע גאוגראפי בתחבורה הציבורית" הזמינים מאתר &lt;a href="http://data.gov.il/">data.gov.il&lt;/a> ועל בסיס תוכנת הקוד הפתוח &lt;a href="http://www.opentripplanner.org/">OpenTripPlanner&lt;/a>.' + '&lt;br>' + 'תרגום התוכנה לעברית בוצע ע"י ירון שהרבני. אירוח אתר זה בחסות &lt;a href="http://www.hamakor.org.il/">עמותת המקור&lt;/a> ובאדיבות &lt;a href="http://www.hetz.biz/">חץ ביז&lt;/a>.' + '&lt;br>' +  'תנאי שימוש: עמותת המקור עושה כמיטב יכולתה בכדי לספק שירות זה על בסיס נתונים מדוייקים ועדכניים אולם ייתכנו טעויות. המידע ניתן כפי שהוא ללא אחריות. ראו גם &lt;a href="http://data.gov.il/dataset/383">תנאי שימוש של משרד התחבורה&lt;/a>.'</span></code></pre>
<p>עכשיו לרפרש את הדפדפן ולהנות מההמשק העברי. יתכן שתתקבל הודעה על כשלון בחישוב המסלול. במקרה זה, יש לבחור תאריך חדש לחישוב בתחום המכוסה על-ידי הקובץ (יום הורדת הקובץ ועד שבועיים קדימה)</p>

        </div>

<div class="comments" id="comments">
    
        <h3>תגובות:</h5>
        
    <ul>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <span class="comment-author">יוסי</span>
                    
          (25 במאי 2012 בשעה 14:44): 
        </p>
                <p>כמה זכרון פנימי יש לכם על המחשב שבו בניתם את הגרף של ישראל?
לי יש fedora 64 bit עם 4 ג&#39;יגה זכרון פנימי וזה אף פעם לא הצליח לסיים לבנות את הגרף ..
על כמה מינימום זכרון הייתם ממליצים?
תודה,יוסי</p>
                <button class="comment-reply">
          להגיב
        </button>
                
                    
    <ul>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <a class="comment-author" href="http://yehudab.com/blog">יהודה</a>
                    
          (25 במאי 2012 בשעה 15:11): 
        </p>
                <p>הי יוסי,
כרגע יש לנו 8GB זכרון פיזי, ולבניית בגרף מוקצים 6 מתוכם. זה גם מה שמוקצה אחר-כך לריצה. שים לב, שכדי שjava תדע לנצל את הזכרון הנוסף יש לשנות את פרמטר ה xmx, כפי שמוסבר בפוסט.</p>
                <button class="comment-reply">
          להגיב
        </button>
                
            </li>
        
    </ul>

                
            </li>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <span class="comment-author">יוסי</span>
                    
          (25 במאי 2012 בשעה 15:28): 
        </p>
                <p>קודם כל תודה על התשובה המהירה !
שיניתי את הפרמט xmx כפי שציינתם,אבל זה לא עזר. אני פשוט צריך לשדרג ל8 ג&#39;יגה .

חשבתי שאולי כדאי שתפרסמו את הקובץ Graph.obj שנוצר כדי שאנשים יוכלו להשתמש בו בלי הצורך לקמפל אותו בעצמם על מחשב חזק ..
מה אתה אומר?</p>
                <button class="comment-reply">
          להגיב
        </button>
                
                    
    <ul>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <a class="comment-author" href="http://yehudab.com/blog">יהודה</a>
                    
          (25 במאי 2012 בשעה 15:42): 
        </p>
                <p>יש עם זה שתי בעיות:
הקובץ שנוצר הוא בגודל 1gb, כך שזמן ההורדה עלול להיות גדול. 
גם השימוש בקובץ אחר-כך דורש כמות גדולה של זכרון (קצת פחות, אבל עדיין).
לדעתי פתרון יותר טוב הוא להכין קובץ GTFS חדש שיכיל רק חלק מהמסלולים (נניח רק של דן) לטובת פיתוח ובדיקות.</p>
                <button class="comment-reply">
          להגיב
        </button>
                
            </li>
        
    </ul>

                
            </li>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <span class="comment-author">יוסי</span>
                    
          (25 במאי 2012 בשעה 15:44): 
        </p>
                <p>1. ג&#39;יגה אחד היום זה בקטנה. 10 דקות הורדה ..
2. להשתמש זה באמת דורש פחות זכרון אז זה בעצם מספיק .
3. לחלק את הקובץ GTFS ולהשאיר בו רק חברה (או חברות) מסוימת זה מסובך ולא מומלץ ..</p>
                <button class="comment-reply">
          להגיב
        </button>
                
            </li>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <span class="comment-author">ליאור</span>
                    
          (12 ביוני 2012 בשעה 19:50): 
        </p>
                <p>עשית לי את החודש. אני שובר את הראש כבר יומיים על זה. 
הבעיה שהייתה לי היא קובץ ה-OSM שהשתמשתי בו. הלינק שלך פתר לי את הבעיה.
תודה, תודה, תודה !!!!!!!!!!!</p>
                <button class="comment-reply">
          להגיב
        </button>
                
            </li>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <a class="comment-author" href="http://www.miu.org.il">Nachman</a>
                    
          (28 ביוני 2012 בשעה 2:41): 
        </p>
                <p>for all developers that are interested:

•	I have split the gigantic file for all of Israel into 4 big files for 4 areas: Tel-Aviv Metro, Jerusalem, North and South. Each file includes not only the information relating to  stops in the specific area but all the information relating to any trip that includes stops within the area (e.g. the North file includes trips from Tel-Aviv to Haifa. Etc….)
•	I have also created a small GTFS file for the area of Ramat Aviv Gimel – this file is useful for testing applications because you do not need to wait forever for the data to load…
•	These GTFS files are available for download from the Merhav website at – http://miu.org.il/MIU_v4/docs_activities/transportation.html</p>
                <button class="comment-reply">
          להגיב
        </button>
                
                    
    <ul>
        
            <li data-comment-id="">
                <p class="comment-details" >
                    
                        <a class="comment-author" href="http://yehudab.com/blog">יהודה</a>
                    
          (28 ביוני 2012 בשעה 3:09): 
        </p>
                <p>תודה על שיתוף המידע. שים לב שתצטרך לעדכן אותם מדי פעם, כי טווח הזמנים של הקבצים הוא שבועיים קדימה. 
יהודה</p>
                <button class="comment-reply">
          להגיב
        </button>
                
            </li>
        
    </ul>

                
            </li>
        
    </ul>

    

    
</div>
            <p class="uppercase text-xs mt-6">הבא</p>
            <p class="font-bold mb-2">
                <a href="/blog/2012/05/otp-il-temp-server/">השרות הנסיוני לתכנון נסיעה בתח&quot;צ עלה לאויר</a>
            </p>
        
            <p class="uppercase text-xs mt-6">הקודם</p>

            <p class="font-bold">
                <a href="/blog/2011/12/mako-vod-same-same-but-different/">מאקו VOD – קצת אחרת</a>
            </p>
        
    </div>

    </main>
    <footer class="bg-gray-900 pb-10">
  <p class="block text-center text-sm mb-6">
    CC-BY-SA
    <a href="/">
      Yehuda Bar Nir
    </a>
    &bull; Built with <a href="https://www.11ty.dev/">11ty</a> 
    &bull; Based on <a target="_blank" href="https://github.com/reeseschultz/11r">11r</a> by
    <a target="_blank" href="https://reeseschultz.com">
      Reese Schultz
    </a>
    &bull; אתר נגיש <a href="/blog/accessibility-statement/">הצהרת נגישות</a>
    
  </p>

</footer>
    
    <script src="/assets/lib/cash.js"></script>
    <script src="/assets/main.bundle.js"></script>
    <script async src="https://ackee.yehudab.com/blog-utils.js" 
      data-ackee-server="https://ackee.yehudab.com"
      data-ackee-domain-id="9c5f49e5-e4a2-44dd-99bf-9f38e447246c"
      data-ackee-opts='{ "ignoreLocalhost": true, "detailed": true, "ignoreOwnVisits": true }'></script>
    <script async src="https://bringthemhomenow.net/1.1.0/hostages-ticker.js" 
      integrity="sha384-DHuakkmS4DXvIW79Ttuqjvl95NepBRwfVGx6bmqBJVVwqsosq8hROrydHItKdsne"
      crossorigin="anonymous"></script> 
  </body>
</html>