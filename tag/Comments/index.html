<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    
    <meta itemprop="name" content="Comments | בלוג פשוט">
    <meta itemprop="description" content="צר עולמי כ  U+200A">

    
    <meta name="twitter:title" content="Comments | בלוג פשוט">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="צר עולמי כ  U+200A">
    <meta name="twitter:site" content="@yehudab">
    <meta name="twitter:creator" content="@yehudab">
    <meta name="twitter:image:src" content="">

    
    <meta name="og:title" content="Comments | בלוג פשוט">
    <meta name="og:description" content="צר עולמי כ  U+200A">
    <meta name="og:image" content="">
    <meta name="og:url" content="https://yehudab.com/">
    <meta name="og:site_name" content="בלוג פשוט">
    <meta name="og:locale" content="en_GB">
    <meta name="og:type" content="website">

    <link rel="icon" type="image/x-icon" href="/favicon.ico"/>

    <title>
      Comments
      
       | בלוג פשוט</title>

    <link rel="stylesheet" href="/assets/main.bundle.css">

    
  </head>
  <body class="flex flex-col min-h-screen">
    <header>
  <nav class="container mx-auto max-w-3xl px-8 pt-2 flex flex-wrap justify-between">
    <div>
      <h1>
        <a href="/">בלוג פשוט</a>
      </h1>
      <p>צר עולמי כ  U+200A</p>
    </div>

    <ul class="flex flex-wrap sm:w-32 w-full mt-6 md:justify-between justify-evenly">
      <li>
        <a href="/blog/about">אודות</a>
      </li>
    </ul>
  </nav>
</header>
    <main class="container mx-auto max-w-3xl p-8 grow">
      
  <p class="text-center text-sm italic mb-6">(פוסטים בתיוג <strong>Comments</strong>.)</p>

  

  <div>
    
        
            <div class="mb-8 border-dotted border-b pb-8 border-gray-600">
                <h2>
                    <a class="block" href="/blog/2020/08/11ty-howto-migrate/">מוורדפרס ל-11ty</a>
                </h2>

                <p class="excerpt"></p>

                <span class="block md:inline md:float-left md:pt-4 pt-2 created-date" datetime="Sat Aug 01 2020 15:00:54 GMT+0000 (Coordinated Universal Time)">
                    1 באוגוסט 2020
                </span>

                <a class="tag" href="/tag/Nunjucks">Nunjucks</a><a class="tag" href="/tag/Comments">Comments</a><a class="tag" href="/tag/11ty">11ty</a><a class="tag" href="/tag/וורדפרס">וורדפרס</a>
                <div class="clear-both"></div>

                <div class="content post">
                    <p>אז אחרי שמחליטים על מעבר ל-11ty, צריך לדאוג לשמר את תוכן הפוסטים והתגובות.</p>
<p>בשלב הראשון של המעבר יש צורך ליצא את כל התוכן מוורדפרס ל-Markdown. לטובת זה השתמשתי בפלאגאין לוורדפרס שפותח דווקא עבור Gatsby ונקרא: <a href="https://wordpress.org/plugins/wp-gatsby-markdown-exporter/">WP Gatsby Markdown Exporter</a>. בקישור ניתן לקרוא כיצד להפעיל אותו. אני השתמשתי באופציית ה <a href="https://wp-cli.org/" title="WordPress Command Line">WP-CLI</a>. משום מה הייתה לו בעיה ליצא את התמונות, ולכן הפעלתי את האופציות שמנטרלות את החלק הזה. הפקודה הסופית הייתה:</p>
<pre class="language-bash"><code class="language-bash">wp gatsby-markdown-export <span class="token parameter variable">--skip_copy_uploads</span> <span class="token parameter variable">--skip_original_images</span> <span class="token parameter variable">--directory</span><span class="token operator">=</span>/var/www/html/md-export</code></pre>
<p>זה מייצר אוסף של קבצי Markdown, שנראה בערך ככה:</p>
<p><img src="/img/2020/08/export.png" alt="היררכיית קבצים לאחר היצוא מוורפרס"></p>
<p>שמות הקבצים בכל תיקייה נלקחים מה slag, ולמזלי הקפדתי לאורך השנים להשתמש בשמות באנגלית, כך שכעת קל למצוא את הפוסטים לפי שנה, חודש וה slag.</p>
<p>בשלב הבא בחרתי ב starter project מתוך <a href="https://jamstackthemes.dev/ssg/eleventy/" title="Eleventy Themes">דף התבניות של Eleventy</a>. המבחר די דל, ואין עדיין אף תבנית מותאמת עברית. לבסוף, בחרתי בתבנית <a href="https://github.com/reeseschultz/11r">11r</a>.  זוהי תבנית dark mode, ומבוססת <a href="https://tailwindcss.com/">Tailwind CSS</a>, ורוב היפוכי הכוון הגיעו out of the box, ברגע שהוספתי <code>dir=rtl</code> לתגית הראשית של הדף. את התוצאה אחרי הגיור תוכלו למזלג <a href="https://github.com/yehudab/11r">מהריפו שלי</a>. את הפוסטים בהיררכיה המקורית מעלים לתיקיית <code>src/posts</code>, ואחרי מעקב אחרי ההוראות בREADME, אפשר לראות את התוצאה.</p>
<p>החלק היותר מורכב בתהליך הוא תמיכה בתגובות. כאן עדיין אין פתרון בית-ספר, ונאלצתי לאלתר <a href="https://github.com/dKab/blog/blob/master/_includes/comments.liquid">מכמה</a> <a href="https://travisdowns.github.io/blog/2020/02/05/now-with-comments.html">מקורות</a>. הבעיה הבסיסית היא שאתר סטטי מטיבו אינו מאפשר הוספת תוכן דינמי כמו תגובות. אחד הפתרון האפשריים הוא שימוש בתוסף צד שלישי כמו <a href="https://disqus.com/">Disqus</a>, אבל <a href="https://fatfrogmedia.com/delete-disqus-comments-wordpress/" title="Why I Deleted Disqus and Why You Should Too">הדעה</a> <a href="https://markosaric.com/remove-disqus/" title="Why you should remove Disqus from your site">המקובלת</a> בקרב בעלי האתרים הסטטים הוא שזה לא לעניין, הן בגלל <a href="https://markosaric.com/remove-disqus/#site-speed-and-performance">תוספת הקוד לכל דף</a>, והן בגלל טענות על <a href="https://twitter.com/martingund/status/1207327648093003777" title="disqus shared the personal data of tens of millions of users ">הפרת פרטיות של משתמשי המערכת</a>.</p>
<p>האפשרות שאני בחרתי בה היא שימוש ב <a href="https://staticman.net/">Staticman</a>. הרעיון כאן הוא שכל תגובה היא בעצם קובץ שנשמר גם כן בgit, ומנגנון אישור התגובה נעשה באופן דומה לאישור Pull Request. המנוע של Staticman דואג לייצר את ה PR-ים, כך שמבחינת המשתמשים באתר שליחת התגובה מתבצעת באמצעות טופס על הדף, בדומה לוורדפרס.</p>
<p>בנוסף לזה, יש צורך לייבא ולשמר את התגובות מהבלוג הישן. כאן השתמשתי <a href="https://github.com/arthurlacoste/wordpress-comments-jekyll-staticman">בכלי</a> שבמקור נכתב לטובת העברת תגובות לאתרים סטטים מבוססי <a href="https://jekyllrb.com/">Jekyll</a>. נדרשו שינויים קלים, אבל בסופו של דבר גם כאן זה מסתכם בהרצה לפי ה README, והוספה של כל קבצי התגובות תחת התיקיה <a href="https://github.com/yehudab/11r/tree/master/11r/src/globals/comments"><code>src/globals/comments</code></a> כך שכל התגובות לפוסט מסויים מרוכזות תחת תיקיה לפי ה slag של הפוסט. מי שמעוניין יכול לקרוא עוד על <a href="https://www.11ty.dev/docs/data-global/">מודל הנתונים של Eleventy</a>.</p>
<p>התוספת האחרונה היא מעט קוד שידע לשלוף את התגובות המתאימות לכל פוסט ולהציג אותן לפי ההיררכיה המקורית. הקוד הזה מחולק בין קוד JS, שאותו ניתן למצוא ב <code>/filters/comments-tree.js</code> ונראה כך:</p>
<pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> allComments <span class="token operator">=</span> obj <span class="token operator">?</span> Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> commentsById <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><br>  allComments<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    c<span class="token punctuation">.</span>id <span class="token operator">=</span> c<span class="token punctuation">.</span>id <span class="token operator">||</span> c<span class="token punctuation">.</span>_id<span class="token punctuation">;</span><br>    commentsById<span class="token punctuation">[</span>c<span class="token punctuation">.</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> c<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> rootComments <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  allComments<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">c</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c<span class="token punctuation">.</span>parentId <span class="token operator">&amp;&amp;</span> c<span class="token punctuation">.</span>parentId <span class="token operator">!==</span> <span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">const</span> parent <span class="token operator">=</span> commentsById<span class="token punctuation">[</span>c<span class="token punctuation">.</span>parentId<span class="token punctuation">]</span><span class="token punctuation">;</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        parent<span class="token punctuation">.</span>replies <span class="token operator">=</span> parent<span class="token punctuation">.</span>replies <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>        parent<span class="token punctuation">.</span>replies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">can't find parentID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>c<span class="token punctuation">.</span>parentId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> for ID: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>c<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>      rootComments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> rootComments<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>והחלק המשלים שנמצא בתבנית התגובות <a href="https://github.com/yehudab/11r/blob/master/src/includes/comments.njk"><code>src/includes/comments.njk</code></a>. על ריקורסיה ב nunjucks למדתי <a href="https://github.com/mozilla/nunjucks/issues/416#issuecomment-206335032">מהissue הזה</a>. עכשיו ניתן לראות גם את התגובות בהתאם לדו-שיח שנוהל בזמנו:</p>
<p><img src="/img/2020/09/comments-dark.png" alt="תגובות משורשרות"></p>
<p>בפוסט הבא ארחיב על הכנת הטופס לתגובות והאינטגרציה עם הבוט של Staticman.</p>

                </div>
            </div>
        
    
</div>

  <div class="grid grid-flow-row grid-cols-3 gap-4 mb-2">
    
    
        <a class="tag mx-auto" href="/tag/ie8">ie8&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/מיקרוסופט">מיקרוסופט&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/דפדפנים">דפדפנים&rlm; (10)</a>
    
        <a class="tag mx-auto" href="/tag/כללי">כללי&rlm; (3)</a>
    
        <a class="tag mx-auto" href="/tag/אורנג&#39;">אורנג&#39;&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/אתרים בארץ">אתרים בארץ&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/שמישות">שמישות&rlm; (3)</a>
    
        <a class="tag mx-auto" href="/tag/BlogDay2008">BlogDay2008&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/habari">habari&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/הבארי">הבארי&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/CSS">CSS&rlm; (3)</a>
    
        <a class="tag mx-auto" href="/tag/פיירפוקס">פיירפוקס&rlm; (10)</a>
    
        <a class="tag mx-auto" href="/tag/אופרה">אופרה&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/ספארי">ספארי&rlm; (3)</a>
    
        <a class="tag mx-auto" href="/tag/נגנים">נגנים&rlm; (3)</a>
    
        <a class="tag mx-auto" href="/tag/Flip4Mac">Flip4Mac&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/מק">מק&rlm; (4)</a>
    
        <a class="tag mx-auto" href="/tag/גראצ&#39;ו מרקס">גראצ&#39;ו מרקס&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/ogg">ogg&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/video">video&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/Uncategorized">Uncategorized&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/שטויות שמוצאים באתרים">שטויות שמוצאים באתרים&rlm; (3)</a>
    
        <a class="tag mx-auto" href="/tag/וורדפרס">וורדפרס&rlm; (8)</a>
    
        <a class="tag mx-auto" href="/tag/אתרים תומכי פיירפוקס">אתרים תומכי פיירפוקס&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/לאומי-קארד">לאומי-קארד&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/ie6">ie6&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/acid2">acid2&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/אינטרנט אקספלורר">אינטרנט אקספלורר&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/Google wave">Google wave&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/בלוגיה">בלוגיה&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/תפוז">תפוז&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/gps">gps&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/ביקורת מוצרים">ביקורת מוצרים&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/garmin">garmin&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/speedtraps">speedtraps&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/ווידג&#39;טים">ווידג&#39;טים&rlm; (4)</a>
    
        <a class="tag mx-auto" href="/tag/רכבת ישראל">רכבת ישראל&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/מזג אויר">מזג אויר&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/קוד פתוח ותוכנה חופשית">קוד פתוח ותוכנה חופשית&rlm; (6)</a>
    
        <a class="tag mx-auto" href="/tag/חלונות">חלונות&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/wordpress">wordpress&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/שעון קיץ">שעון קיץ&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/חולצה">חולצה&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/TwentyTwenty">TwentyTwenty&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/nano">nano&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/php">php&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/vi">vi&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/לינוקס">לינוקס&rlm; (2)</a>
    
        <a class="tag mx-auto" href="/tag/SSG">SSG&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/11ty">11ty&rlm; (3)</a>
    
        <a class="tag mx-auto" href="/tag/בלוג">בלוג&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/Docker">Docker&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/Hosting">Hosting&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/Nunjucks">Nunjucks&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/Comments">Comments&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/staticman">staticman&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/Geotagging">Geotagging&rlm; (1)</a>
    
        <a class="tag mx-auto" href="/tag/שביל ישראל">שביל ישראל&rlm; (1)</a>
    
</div>

    </main>
    <footer class="bg-gray-900 pb-10">
  <p class="block text-center text-sm mb-6">
    CC-BY-SA
    <a href="/">
      Yehuda Bar Nir
    </a>
    &bull; Built with <a href="https://www.11ty.dev/">11ty</a> 
    &bull; Based on <a target="_blank" href="https://github.com/reeseschultz/11r">11r</a> by
    <a target="_blank" href="https://reeseschultz.com">
      Reese Schultz
    </a>
    &bull; אתר נגיש <a href="/blog/accessibility-statement/">הצהרת נגישות</a> 
  </p>

</footer>
    
    <script src="/assets/lib/cash.js"></script>
    <script src="/assets/main.bundle.js"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script async src="https://ackee.yehudab.com/blog-utils.js" 
      data-ackee-server="https://ackee.yehudab.com"
      data-ackee-domain-id="9c5f49e5-e4a2-44dd-99bf-9f38e447246c"
      data-ackee-opts='{ "ignoreLocalhost": true, "detailed": true, "ignoreOwnVisits": true }'></script>
  </body>
</html>